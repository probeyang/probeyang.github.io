



<!DOCTYPE html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Python,PHP,MySQL,Docker,软件工程,人工智能,机器学习,深度学习,TensorFlow等知识">
      
      
      
        <meta name="author" content="probe">
      
      
        <meta name="lang:clipboard.copy" content="复制">
      
        <meta name="lang:clipboard.copied" content="已复制">
      
        <meta name="lang:search.language" content="en, jp">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="没有找到符合条件的结果">
      
        <meta name="lang:search.result.one" content="找到 1 个符合条件的结果">
      
        <meta name="lang:search.result.other" content="# 个符合条件的结果">
      
        <meta name="lang:search.tokenizer" content="[\uff0c\u3002]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-0.17.4, mkdocs-material-2.9.1">
    
    
      
        <title>docker-swarm集群服务试玩系列1 - Sanlt,就是加了N多盐的地方</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.ba0fd1a6.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#docker-swarm" tabindex="1" class="md-skip">
        跳转至
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Sanlt,就是加了N多盐的地方" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                Sanlt,就是加了N多盐的地方
              </span>
              <span class="md-header-nav__topic">
                docker-swarm集群服务试玩系列1
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="搜索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            键入以开始搜索
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <span class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </span>
    Sanlt,就是加了N多盐的地方
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="首页" class="md-nav__link">
      首页
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Linux 知识
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Linux 知识
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../linux/aliyun_REMOTE_HOST_HAS_CHANGE_deal/" title="阿里云host_has_change" class="md-nav__link">
      阿里云host_has_change
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../linux/headless_chrome_desc/" title="HeadlessChrome入门" class="md-nav__link">
      HeadlessChrome入门
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Python 知识
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Python 知识
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../python/celery_version_question/" title="celery版本问题处理" class="md-nav__link">
      celery版本问题处理
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../python/dict_first_item/" title="python获取每个元祖的第一个值" class="md-nav__link">
      python获取每个元祖的第一个值
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../python/list_uniqio_and_sort/" title="list去重并保留原顺序" class="md-nav__link">
      list去重并保留原顺序
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../python/ordereddict_use_notice/" title="OrderDict使用问题" class="md-nav__link">
      OrderDict使用问题
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../python/nonlocal_study/" title="nonlocal的使用" class="md-nav__link">
      nonlocal的使用
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../python/fsum_study/" title="fsum函数的使用" class="md-nav__link">
      fsum函数的使用
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../python/func_add_bracket/" title="函数加括号与不加括号" class="md-nav__link">
      函数加括号与不加括号
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../python/black_code_format_tool/" title="black格式化工具使用" class="md-nav__link">
      black格式化工具使用
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      设计模式
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        设计模式
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../pattern_design/simple_factory/" title="三种工厂模式详解" class="md-nav__link">
      三种工厂模式详解
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../pattern_design/singleton/" title="单例模式详解" class="md-nav__link">
      单例模式详解
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../pattern_design/template_method/" title="模板方法模式详解" class="md-nav__link">
      模板方法模式详解
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../pattern_design/state_pattern/" title="状态模式详解" class="md-nav__link">
      状态模式详解
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5">
    
    <label class="md-nav__link" for="nav-5">
      MySQL 知识
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        MySQL 知识
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../mysql/mysqldump_usage/" title="mysqldump命令参数详解" class="md-nav__link">
      mysqldump命令参数详解
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../mysql/mysqlbinlog_study/" title="用mysqlbinlog查看日志" class="md-nav__link">
      用mysqlbinlog查看日志
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6" checked>
    
    <label class="md-nav__link" for="nav-6">
      Docker 知识
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Docker 知识
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        docker-swarm集群服务试玩系列1
      </label>
    
    <a href="./" title="docker-swarm集群服务试玩系列1" class="md-nav__link md-nav__link--active">
      docker-swarm集群服务试玩系列1
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" title="前言" class="md-nav__link">
    前言
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" title="环境准备" class="md-nav__link">
    环境准备
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" title="环境搭建" class="md-nav__link">
    环境搭建
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" title="环境安装：" class="md-nav__link">
    环境安装：
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#docker" title="Docker环境安装：" class="md-nav__link">
    Docker环境安装：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#virtualbox" title="virtualbox安装" class="md-nav__link">
    virtualbox安装
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#boot2docker" title="boot2docker安装" class="md-nav__link">
    boot2docker安装
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docker-swarm_1" title="Docker Swarm集群实验" class="md-nav__link">
    Docker Swarm集群实验
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41master-3slave" title="先创建4个虚拟节点（1个master + 3个slave）" class="md-nav__link">
    先创建4个虚拟节点（1个master + 3个slave）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ssh" title="ssh接入到虚拟节点" class="md-nav__link">
    ssh接入到虚拟节点
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#masterdocker-swarm" title="在master上初始化一個docker swarm集群" class="md-nav__link">
    在master上初始化一個docker swarm集群
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3slave" title="將3個slave節點加入集群" class="md-nav__link">
    將3個slave節點加入集群
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../docker_swarm_cluster_demo1/" title="docker-swarm集群服务试玩系列2" class="md-nav__link">
      docker-swarm集群服务试玩系列2
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../docker_swarm_cluster_demo2/" title="docker-swarm集群服务试玩系列3" class="md-nav__link">
      docker-swarm集群服务试玩系列3
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Tool 指南
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Tool 指南
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../tool/uml_class_study/" title="UML类图使用说明" class="md-nav__link">
      UML类图使用说明
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tool/uml_shixu_study/" title="UML时序图使用说明" class="md-nav__link">
      UML时序图使用说明
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../tool/vscode_plantuml_usage/" title="vscode安装plantuml说明" class="md-nav__link">
      vscode安装plantuml说明
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      关于我
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        关于我
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../about/me/" title="关于我" class="md-nav__link">
      关于我
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../about/normal_style/" title="常见样式选择" class="md-nav__link">
      常见样式选择
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">目录</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_1" title="前言" class="md-nav__link">
    前言
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_2" title="环境准备" class="md-nav__link">
    环境准备
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_3" title="环境搭建" class="md-nav__link">
    环境搭建
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" title="环境安装：" class="md-nav__link">
    环境安装：
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#docker" title="Docker环境安装：" class="md-nav__link">
    Docker环境安装：
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#virtualbox" title="virtualbox安装" class="md-nav__link">
    virtualbox安装
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#boot2docker" title="boot2docker安装" class="md-nav__link">
    boot2docker安装
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docker-swarm_1" title="Docker Swarm集群实验" class="md-nav__link">
    Docker Swarm集群实验
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41master-3slave" title="先创建4个虚拟节点（1个master + 3个slave）" class="md-nav__link">
    先创建4个虚拟节点（1个master + 3个slave）
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ssh" title="ssh接入到虚拟节点" class="md-nav__link">
    ssh接入到虚拟节点
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#masterdocker-swarm" title="在master上初始化一個docker swarm集群" class="md-nav__link">
    在master上初始化一個docker swarm集群
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3slave" title="將3個slave節點加入集群" class="md-nav__link">
    將3個slave節點加入集群
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="docker-swarm">第一部分 docker swarm集群搭建</h1>
<details class="note" open="open"><summary>docker swarm 基础系列文章</summary><p><a href="https://www.sanlt.com/docker/docker_swarm_cluster_demo/">系列之一：集群搭建</a></p><p><a href="https://www.sanlt.com/docker/docker_swarm_cluster_demo1/">系列之二：服务创建与扩容</a></p><p><a href="https://www.sanlt.com/docker/docker_swarm_cluster_demo2/">系列之三：集群服务高可用</a></p></details><h2 id="_1">前言</h2>
<p>相信Docker技术大家都有所了解，单个Docker能发挥的作用毕竟有限，也不便于管理，所以Docker得组集群来使用才能发挥强大的技术优势。既然要组集群那就涉及诸如Docker的资源调度、管理等等一系列问题。目前涉及Docker集群的三个主要的技术无外乎Swarm、Kubernetes、Mesos三种。从本文开始作者将会一一实践这几种主要的Docker集群技术，话不多说，现在开始。</p>
<p>注意：作者的kubernetes相关实践在此</p>
<h2 id="_2">环境准备</h2>
<ul>
<li>
<p>Mac OS X 10.13.2</p>
</li>
<li>
<p>Docker 17.09.1-ce-mac42 (21090)</p>
</li>
<li>
<p>virtualbox（虚拟集群中节点时需要）</p>
</li>
<li>
<p>boot2docker v1.8.0（在虚拟节点中起docker环境时需要）</p>
</li>
</ul>
<h2 id="_3">环境搭建</h2>
<p>节点规划如下：</p>
<p><img alt="节点示意图" src="../../img/DD73DDA7CE250B87F722B6D815BBC197.jpg" title="节点示意图" /></p>
<p>我们需要4个节点（1个master + 3个slave），由于没有真实地4台物理机，所以下文中是靠docker-machine、virtualbox以及boot2docker来虚拟出4个独立IP地址的带docker环境的节点，大家注意！</p>
<h2 id="_4">环境安装：</h2>
<h3 id="docker">Docker环境安装：</h3>
<p><code>Tips： 以前Mac上一般是使用boot2docker这个专门为OS X上运行Docker而开发的一个轻量级的虚拟主机管理工具来安装docker，现在boot2docker这种安装方式官方已经deprecated了（当然下文中还是需要boot2docker.iso的镜像来帮助我们在虚拟的节点上起docker环境），可以直接下载docker的dmg安装包双击进行安装即可</code></p>
<p>下载的boot2docker.iso文件放到~/.docker/machine/cache目录下面（拷贝）：</p>
<div class="highlight"><pre><span></span><span class="o">[</span>probeyang@bogon ~ <span class="o">]</span>$ <span class="nb">cd</span>  ~/.docker/machine/cache
<span class="o">[</span>probeyang@bogon cache <span class="o">]</span>$ ls
boot2docker.iso
</pre></div>

<p>我们选择docker CE版安装即可，下载链接如下:</p>
<p><a href="https://store.docker.com/search?type=edition&amp;offering=community">https://store.docker.com/search?type=edition&amp;offering=community</a></p>
<p><code>选择官方docker dmg包安装完成以后，docker-machine已经天然地集成于其中了，该工具在下文中创建虚拟节点时需要，它是一个可以在虚拟主机节点上安装docker engine的工具</code></p>
<h3 id="virtualbox">virtualbox安装</h3>
<p><code>由于我们搭建集群需要具备多个不同IP地址的节点，然而我们手上仅一台电脑，所以需要借助virtualbox来虚拟出多个不同IP地址的节点供我们使用需要</code></p>
<p>去官方下载virtualbox的dmg安装包，双击安装即可：</p>
<p><a href="https://www.virtualbox.org/">https://www.virtualbox.org/</a></p>
<h3 id="boot2docker">boot2docker安装</h3>
<p>Boot2Docker是一个专为Docker而设计的轻量级Linux发型包，解决Windows或者OS X用户不能安装Docker的问题。Boot2Docker完全运行于内存中，体积小，启动快。Boot2Docker需要运行在VirtualBox中。</p>
<p>我使用的是brew这个mac上的包管理器安装的，非常方便，只需一行命令：</p>
<div class="highlight"><pre><span></span>brew install boot2docker
</pre></div>

<p>除此之外我们还需要下载boot2docker.iso镜像在后文中进行使用：
<a href="https://github.com/boot2docker/boot2docker/releases/tag/v17.07.0-ce">https://github.com/boot2docker/boot2docker/releases/tag/v17.07.0-ce</a> 
我们先把boot2docker.iso下好后面备用</p>
<h2 id="docker-swarm_1">Docker Swarm集群实验</h2>
<h3 id="41master-3slave">先创建4个虚拟节点（1个master + 3个slave）</h3>
<p>首先要将之前下载的boot2docker.iso放到/Users/你的用戶名/.docker/machine/cache/目录下，然后执行如下命令：</p>
<div class="highlight"><pre><span></span>docker-machine create --virtualbox-boot2docker-url ~/.docker/machine/cache/boot2docker.iso master
docker-machine create --virtualbox-boot2docker-url ~/.docker/machine/cache/boot2docker.iso slave1
docker-machine create --virtualbox-boot2docker-url ~/.docker/machine/cache/boot2docker.iso slave2
docker-machine create --virtualbox-boot2docker-url ~/.docker/machine/cache/boot2docker.iso slave3
</pre></div>

<p>docker-machine create命令运行结果类似如下：</p>
<div class="highlight"><pre><span></span><span class="o">[</span>probeyang@bogon swarm <span class="o">]</span>$ docker-machine create --virtualbox-boot2docker-url ~/.docker/machine/cache/boot2docker.iso master
Running pre-create checks...
<span class="o">(</span>master<span class="o">)</span> Boot2Docker URL was explicitly <span class="nb">set</span> to <span class="s2">&quot;/Users/probeyang/.docker/machine/cache/boot2docker.iso&quot;</span> at create time, so Docker Machine cannot upgrade this machine to the latest version.
Creating machine...
<span class="o">(</span>master<span class="o">)</span> Boot2Docker URL was explicitly <span class="nb">set</span> to <span class="s2">&quot;/Users/probeyang/.docker/machine/cache/boot2docker.iso&quot;</span> at create time, so Docker Machine cannot upgrade this machine to the latest version.
<span class="o">(</span>master<span class="o">)</span> Downloading /Users/probeyang/.docker/machine/cache/boot2docker.iso from /Users/probeyang/.docker/machine/cache/boot2docker.iso...
<span class="o">(</span>master<span class="o">)</span> Creating VirtualBox VM...
<span class="o">(</span>master<span class="o">)</span> Creating SSH key...
<span class="o">(</span>master<span class="o">)</span> Starting the VM...
<span class="o">(</span>master<span class="o">)</span> Check network to re-create <span class="k">if</span> needed...
<span class="o">(</span>master<span class="o">)</span> Waiting <span class="k">for</span> an IP...
Waiting <span class="k">for</span> machine to be running, this may take a few minutes...
Detecting operating system of created instance...
Waiting <span class="k">for</span> SSH to be available...
Detecting the provisioner...
Provisioning with boot2docker...
Copying certs to the <span class="nb">local</span> machine directory...
Copying certs to the remote machine...
Setting Docker configuration on the remote daemon...
Checking connection to Docker...
Docker is up and running!
To see how to connect your Docker Client to the Docker Engine running on this virtual machine, run: docker-machine env master
<span class="o">[</span>probeyang@bogon swarm <span class="o">]</span>$ docker-machine create --virtualbox-boot2docker-url ~/.docker/machine/cache/boot2docker.iso slave1
Running pre-create checks...
<span class="o">(</span>slave1<span class="o">)</span> Boot2Docker URL was explicitly <span class="nb">set</span> to <span class="s2">&quot;/Users/probeyang/.docker/machine/cache/boot2docker.iso&quot;</span> at create time, so Docker Machine cannot upgrade this machine to the latest version.
Creating machine...
<span class="o">(</span>slave1<span class="o">)</span> Boot2Docker URL was explicitly <span class="nb">set</span> to <span class="s2">&quot;/Users/probeyang/.docker/machine/cache/boot2docker.iso&quot;</span> at create time, so Docker Machine cannot upgrade this machine to the latest version.
<span class="o">(</span>slave1<span class="o">)</span> Downloading /Users/probeyang/.docker/machine/cache/boot2docker.iso from /Users/probeyang/.docker/machine/cache/boot2docker.iso...
<span class="o">(</span>slave1<span class="o">)</span> Creating VirtualBox VM...
<span class="o">(</span>slave1<span class="o">)</span> Creating SSH key...
<span class="o">(</span>slave1<span class="o">)</span> Starting the VM...
<span class="o">(</span>slave1<span class="o">)</span> Check network to re-create <span class="k">if</span> needed...
<span class="o">(</span>slave1<span class="o">)</span> Waiting <span class="k">for</span> an IP...
Waiting <span class="k">for</span> machine to be running, this may take a few minutes...
Detecting operating system of created instance...
Waiting <span class="k">for</span> SSH to be available...
Detecting the provisioner...
Provisioning with boot2docker...
Copying certs to the <span class="nb">local</span> machine directory...
Copying certs to the remote machine...
Setting Docker configuration on the remote daemon...
Checking connection to Docker...
Docker is up and running!
To see how to connect your Docker Client to the Docker Engine running on this virtual machine, run: docker-machine env slave1
</pre></div>

<p><code>注意：上面若不指定boot2docker的路径：--virtualbox-boot2docker-url ~/.docker/machine/cache/boot2docker.iso，直接执行docker-machine create master创建节点时，可能会报No default Boot2Docker ISO found locally, downloading the latest release...这种错误！所以最好自己指定boot2docker.iso镜像路径</code></p>
<p>创建完4个节点以后，可以用docker-machine ls命令查看一下各个节点的情况，可以看到自动为其分配了独立的IP地址：</p>
<div class="highlight"><pre><span></span><span class="o">[</span>probeyang@bogon swarm <span class="o">]</span>$ docker-machine ls
NAME             ACTIVE   DRIVER       STATE     URL                         SWARM   DOCKER        ERRORS
consul-machine   -        virtualbox   Stopped                                       Unknown
master           -        virtualbox   Running   tcp://192.168.99.100:2376           v17.07.0-ce
slave1           -        virtualbox   Running   tcp://192.168.99.101:2376           v17.07.0-ce
slave2           -        virtualbox   Running   tcp://192.168.99.102:2376           v17.07.0-ce
slave3           -        virtualbox   Running   tcp://192.168.99.103:2376           v17.07.0-ce
</pre></div>

<p>可以看到，我们创建了1个master，3个slave的虚拟机，docker为其各自分配了不同的IP地址。</p>
<h3 id="ssh">ssh接入到虚拟节点</h3>
<p>分别开启4个独立的terminal终端，分别执行：</p>
<div class="superfences-tabs">
<input name="__tabs_1" type="radio" id="__tab_1_0" checked="checked" />
<label for="__tab_1_0">Bash</label>
<div class="superfences-content"><div class="highlight"><pre><span></span>docker-machine ssh master
</pre></div></div>
<input name="__tabs_1" type="radio" id="__tab_1_1" />
<label for="__tab_1_1">Bash</label>
<div class="superfences-content"><div class="highlight"><pre><span></span>docker-machine ssh slave1
</pre></div></div>
<input name="__tabs_1" type="radio" id="__tab_1_2" />
<label for="__tab_1_2">Bash</label>
<div class="superfences-content"><div class="highlight"><pre><span></span>docker-machine ssh slave2
</pre></div></div>
<input name="__tabs_1" type="radio" id="__tab_1_3" />
<label for="__tab_1_3">Bash</label>
<div class="superfences-content"><div class="highlight"><pre><span></span>docker-machine ssh slave3
</pre></div></div>
</div>
<p>执行效果如下：</p>
<div class="highlight"><pre><span></span><span class="o">[</span>probeyang@bogon swarm <span class="o">]</span>$ docker-machine ssh master
                        <span class="c1">##         .</span>
                  <span class="c1">## ## ##        ==</span>
               <span class="c1">## ## ## ## ##    ===</span>
           /<span class="s2">&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;&quot;\___/ ===</span>
<span class="s2">      ~~~ {~~ ~~~~ ~~~ ~~~~ ~~~ ~ /  ===- ~~~</span>
<span class="s2">           \______ o           __/</span>
<span class="s2">             \    \         __/</span>
<span class="s2">              \____\_______/</span>
<span class="s2"> _                 _   ____     _            _</span>
<span class="s2">| |__   ___   ___ | |_|___ \ __| | ___   ___| | _____ _ __</span>
<span class="s2">| &#39;_ \ / _ \ / _ \| __| __) / _` |/ _ \ / __| |/ / _ \ &#39;__|</span>
<span class="s2">| |_) | (_) | (_) | |_ / __/ (_| | (_) | (__|   &lt;  __/ |</span>
<span class="s2">|_.__/ \___/ \___/ \__|_____\__,_|\___/ \___|_|\_\___|_|</span>
<span class="s2">Boot2Docker version 17.07.0-ce, build HEAD : 24e9d2f - Wed Aug 30 00:04:56 UTC 2017</span>
<span class="s2">Docker version 17.07.0-ce, build 8784753</span>
<span class="s2">docker@master:~</span>$<span class="s2"> exit</span>
</pre></div>

<p><img alt="IMAGE" src="../../img/F83F435A0603C92B335A9057F7A4493C.jpg" title="演示图" /></p>
<h3 id="masterdocker-swarm">在master上初始化一個docker swarm集群</h3>
<p>執行命令：
<div class="highlight"><pre><span></span>docker swarm init --advertise-addr <span class="m">192</span>.168.99.100
</pre></div></p>
<p>效果如下：</p>
<p><img alt="IMAGE" src="../../img/1DCA4A58864A0DF813238538066E0FD8.jpg" title="演示图" /></p>
<p>上述命令執行成功後，提示中會告知用戶在slave節點上執行命令 docker swarm join --token SWMTKN-1-1uzft9zcrd5cl7eva4gr4ptgrs1gc252483ey19xfphcuxc8ta-evsmmj7b7kleh7yoezjutzuu2 192.168.99.100:2377
可以加入到該集群中，把命令都告訴你了，你說智不智能！</p>
<h3 id="3slave">將3個slave節點加入集群</h3>
<p>分別去三個slave上，輸入上面提示中的命令：</p>
<div class="highlight"><pre><span></span>docker swarm join --token SWMTKN-1-1uzft9zcrd5cl7eva4gr4ptgrs1gc252483ey19xfphcuxc8ta-evsmmj7b7kleh7yoezjutzuu2 <span class="m">192</span>.168.99.100:2377
</pre></div>

<p>執行效果如下：</p>
<p><img alt="IMAGE" src="../../img/ADA2D3BCB56873CF7F94F6D9F18F18F3.jpg" title="演示图" /></p>
<p><code>註意：如果忘了docker swarm join 命令中的token命令的話，可以使用命令docker swarm join-token worker來get之</code></p>
<p>好，到此為止應該說docker swarm集群的搭建工作已經完成了，那下面在這個集群上做點實際的任務吧！</p>
<p>参考文献：</p>
<p><a href="http://www.itread01.com/content/1519793891.html">Docker Swarm集群初探</a></p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../../mysql/mysqlbinlog_study/" title="用mysqlbinlog查看日志" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  后退
                </span>
                用mysqlbinlog查看日志
              </span>
            </div>
          </a>
        
        
          <a href="../docker_swarm_cluster_demo1/" title="docker-swarm集群服务试玩系列2" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  前进
                </span>
                docker-swarm集群服务试玩系列2
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; <a href="https://www.sanlt.com/">sanlt.com</a> All Rights Reserved.
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.a59e2a89.js"></script>
      
        
        
          
          <script src="../../assets/javascripts/lunr/lunr.stemmer.support.js"></script>
          
            
          
            
              
                <script src="../../assets/javascripts/lunr/tinyseg.js"></script>
              
              
                <script src="../../assets/javascripts/lunr/lunr.jp.js"></script>
              
            
          
          
            <script src="../../assets/javascripts/lunr/lunr.multi.js"></script>
          
        
      
      <script>app.initialize({version:"0.17.4",url:{base:"../.."}})</script>
      
    
    
      
    
  </body>
</html>